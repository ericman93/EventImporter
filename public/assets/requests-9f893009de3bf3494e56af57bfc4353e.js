function show_calendar(){$("#calendar").html(""),$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},events:"/events/"+user_name,eventBorderColor:"black",loading:function(e){e?loadPopup():disablePopup()},eventRender:function(e,t){t.bind("dblclick",function(){send_option_selection(e.id)})},defaultView:"agendaWeek"})}function show_request_proposels(e){set_request_active(e);var t=requests.filter(function(t){return t.id==e});build_proposel_list(t[0].request_proposals)}function build_proposel_list(e){$("#calendar").fullCalendar("removeEvents","prop_"+current_proposel),$("#request_proposels_list").empty(),$.each(e,function(e,t){start=new Date(t.start_time),end=new Date(t.end_time);var r='<li id="proposel_'+t.id+'"><a href="#" onclick="proposal_selected('+t.id+","+t.request_id+')">'+start.toLocaleString()+" - "+end.toLocaleString()+"</a></li>";$("#request_proposels_list").append(r)})}function proposal_selected(e,t){var r=requests.filter(function(e){return e.id==t}),n=r[0].request_proposals.filter(function(t){return t.id==e});n=n[0],start_time=new Date(n.start_time),$("#calendar").fullCalendar("gotoDate",start_time);var o={title:"Proposel",start:start_time,allDay:!1,id:"prop_"+e,end:new Date(n.end_time),className:"option_event"};set_propoal_active(e),$("#calendar").fullCalendar("removeEvents","prop_"+current_proposel),current_proposel=e,$("#calendar").fullCalendar("renderEvent",o)}function set_request_active(e){$("#request_"+current_request).removeClass("active"),$("#request_"+e).addClass("active"),current_request=e}function set_propoal_active(e){$("#proposel_"+current_proposel).removeClass("active"),$("#proposel_"+e).addClass("active")}function delete_request(e){$.ajax({type:"DELETE",url:"/requests/"+e,dataType:"json",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))}}).success(function(){remove_request(e)}).fail(function(){alert("error")})}function send_option_selection(e){option_id=e.substring(5),$.ajax({type:"POST",url:"/requests/"+option_id,dataType:"json",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))}}).success(function(){remove_request()}).fail(function(e){alert("error"),console.log(e)})}function remove_request(e){void 0==e&&(e=current_request),$("#request_"+e).remove(),$("#delete_request_"+e).remove(),e==current_request&&($("#proposel_"+current_proposel).remove(),$("#request_proposels_list").empty(),$("#calendar").fullCalendar("removeEvents","prop_"+current_proposel)),set_request_count()}var current_request=0,current_proposel=0;$(function(){getPartialData("requests/user","#request_data","get",show_calendar)});