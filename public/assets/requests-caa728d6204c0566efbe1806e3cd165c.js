function show_calendar(){$("#calendar").html(""),$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},events:"/events/"+user_name,eventBorderColor:"black",allDaySlot:!1,loading:function(e){e?popupLoading():closeLoading()},eventAfterRender:function(e,t){e.id>0&&e.id.indexOf("prop")>=0&&add_button(e.id,"approve",send_option),fixEventsPosition(t)},defaultView:"agendaWeek"})}function show_request_proposels(e){set_request_active(e);var t=requests.filter(function(t){return t.id==e});build_proposel_list(t[0].request_proposals)}function build_proposel_list(e){$("#calendar").fullCalendar("removeEvents","prop_"+current_proposel),$("#request_proposels_list").empty(),$.each(e,function(e,t){start=new Date(t.start_time),end=new Date(t.end_time);var r='<li id="proposel_'+t.id+'"><a href="#" onclick="proposal_selected('+t.id+","+t.request_id+')">'+start.toLocaleString()+" - "+end.toLocaleString()+"</a></li>";$("#request_proposels_list").append(r)})}function proposal_selected(e,t,r){start=new Date(t),end=new Date(r),$("#calendar").fullCalendar("gotoDate",start);var n="prop_"+e,o={title:"Proposel",allDay:!1,id:n,start:start,end:end,className:"option_event "+n};setPropoalActive(e),$("#calendar").fullCalendar("removeEvents","prop_"+current_proposel),current_proposel=e,$("#calendar").fullCalendar("renderEvent",o),add_button(n,"approve",send_option)}function getSelectedRequestId(){return $(".panel .in").parent("div").data("request-id")}function send_option(e){$.when(showYesOrNo("really ?")).then(function(){send_option_selection(e).then(function(){removeRequest(getSelectedRequestId())},function(e){showError(e)})})}function setPropoalActive(e){$("#prop_"+current_proposel).removeClass("active"),$("#prop_"+e).addClass("active")}function deleteRequest(e){$.ajax({type:"DELETE",url:"/requests/"+e,dataType:"json",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))}}).success(function(){removeRequest(e)}).fail(function(){showError("error")})}function removeRequest(e){void 0==e&&(e=current_request),$("#request-panel-"+e).remove(),e==current_request&&($("#proposel_"+current_proposel).remove(),$("#request_proposels_list").empty(),$("#calendar").fullCalendar("removeEvents","prop_"+current_proposel)),set_request_count()}function clear_propsolas(){$(".fc-event.option_event").remove()}var current_request=0,current_proposel=0;$(function(){getPartialData("requests/user","#request_data","get",show_calendar)});