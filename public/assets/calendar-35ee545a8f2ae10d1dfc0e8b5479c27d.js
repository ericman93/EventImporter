function load_event_to_calendar(e,t,n){$("#calendar").html(""),user_email=e;var o=30,a=getWorkHours(e),s=$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},firstHour:9,hiddenDays:getHolidays(a),slotMinutes:o,events:t?"/events/"+e:[],defaultView:"agendaWeek",selectable:!n,selectHelper:!n,editable:!1,eventBorderColor:"black",select:function(e,t,o){var a="temp_"+options.length;addNewProposal(e,t,o,a),s.fullCalendar("renderEvent",{id:a,start:e,end:t,allDay:o,title:"Option",is_temp:!0,editable:!0,className:"proposel_event "+a},!n)},loading:function(e){e?popupLoading():disablePopup()},eventClick:function(e){e.is_temp||showEvent(e.id)},eventRender:function(e){updateEvent(e),addCloseButton(e.id)}});selectWorkTime(a,o,0,24,!0),setEmailInputs()}function showRequestUserInfo(){$("#result_alert").remove(),loadPopup()}function addCloseButton(e){var t=$("<div/>",{"class":"close-event"}).click(function(){removeProposel(e)});$(".fc-event."+e).prepend(t)}function showEvent(e){window.location="../events/"+e}function getWorkHours(e){return time_day=[],$.ajax({url:"/user/"+e+"/work_day?gmt="+get_gmt_offset(),async:!1,success:function(e){time_day=e}}),time_day}function getHolidays(e){var t=$.map(e,function(e,t){return 0==e.hours[0]&&0==e.hours[1]?t:void 0});return t}function sendToServer(){return 0==options.length?void alert("Please select proposals before sending"):(changeRequestInputDisable(!0),data={proposals:options,request_info:{mail:$("#request_mail_input").val(),name:$("#request_name_input").val()},event_metadata:{subject:$("#event_subject_input").val(),location:$("#event_location_input").val()},user_name:user_email,gmt_offset:get_gmt_offset()},void $.ajax({type:"POST",url:"/requests/proposels",dataType:"json",data:data,beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))}}).success(function(){$.each(options,function(e,t){$("#calendar").fullCalendar("removeEvents",t.temp_id)}),options=[],$("#proposal_table tbody").empty(),addAlert("Request was sent successfuly ;)","alert-success"),clearRequestedForm(),changeRequestInputDisable(!1)}).fail(function(e){var t="";switch(e.status){case 400:t=e.responseText;break;case 500:t="Something went wrong :(";break;default:t="An error as occurred :("}addAlert(t,"alert-danger"),console.log(e),changeRequestInputDisable(!1)}))}function addNewProposal(e,t,n,o){proposel={start_time:e,start_ticks:e.getTime(),end_time:t,end_ticks:t.getTime(),is_all_day:n,temp_id:o},addProposalToPopup(proposel,options.length),options.push(proposel)}function updateEvent(e){$.each(options,function(t,n){return n.temp_id==e.id?(n.start_time=e.start,n.start_ticks=e.start.getTime(),n.end_time=e.end,void(n.end_ticks=e.end.getTime())):void 0});var t=$("#prop_"+e.id+">td");$(t[1]).html(date_to_human(e.start)),$(t[2]).html(date_to_human(e.end))}function addProposalToPopup(e){$("#popup_content #proposal_table tbody").append('<tr id="prop_'+e.temp_id+'"><td>'+getRemoveButtonTd(e.temp_id)+'</td><td class="start_time">'+date_to_human(e.start_time)+'</td><td class="end_time">'+date_to_human(e.end_time)+"</tr>")}function getRemoveButtonTd(e){return'<button type="button" class="btn btn-danger remove-prop-btn" onclick="removeProposel(\''+e+'\')"> <span class="glyphicon glyphicon-remove"/></button>'}function removeProposel(e){$("#prop_"+e).fadeOut(300,function(){$(this).remove()});var t=options.filter(function(t){return t.temp_id==e});index=$(options).index(t[0]),options.splice(index,1),$("#calendar").fullCalendar("removeEvents",e)}function changeRequestInputDisable(e){$("#event_subject_input").prop("disabled",e),$("#event_location_input").prop("disabled",e),$("#request_mail_input").prop("disabled",e),$("#request_name_input").prop("disabled",e),$("#send_request_btn").prop("disabled",e),$(".remove-prop-btn").prop("disabled",e)}function addAlert(e,t){var n=$("<div/>",{id:"result_alert","class":"alert "+t,html:e});$("#popup_content form").append(n)}function clearRequestedForm(){$("#event_subject_input").val(""),$("#event_location_input").val(""),$("#request_mail_input").val(""),$("#request_name_input").val("")}var options=[],user_email;