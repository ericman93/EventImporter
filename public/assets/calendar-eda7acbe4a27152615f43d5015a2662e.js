function load_event_to_calendar(t,n,o,a,s,i){$("#calendar").html(""),user_email=t;var r=30,l=getWorkHours(t),u=$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},height:getCalendarHeight(),firstHour:9,allDaySlot:!1,handleWindowResize:!0,timezone:"local",hiddenDays:getVicationDays(l),slotMinutes:r,events:o?"/events/"+t:[],defaultView:"agendaWeek",selectable:a,selectHelper:a,disableResizing:i,eventBorderColor:"black",dayRender:function(){console.log("test")},select:function(e,t){if(!s&&n&&options.length>0)return showError("You can select only one proposel"),void u.fullCalendar("unselect");var o,r="temp_"+options.length;o=s?prompt("Event Title:"):i?$("#services option:selected").text():"Option",addNewProposal(e,t,r,o);var l={id:r,start:e,end:t,title:o,is_temp:!0,editable:!0,className:(s?"orange-event ":"proposel_event ")+r};u.fullCalendar("renderEvent",l,a),u.fullCalendar("unselect")},loading:function(e){e?popupLoading():(closeLoading(),showRequestInfoWindow())},eventAfterRender:function(t,n){updateEvent(t),add_button(t.id,"close",removeProposel),$.each($(".fc-event"),function(t){e=$(".fc-event")[t],$(e).css("top",$(e).css("top"))}),fixEventsPosition(n)},viewRender:function(){selectWorkTime(l,r,0,24,!0)}});setEmailInputs()}function showRequestUserInfo(){$("#result_alert").remove(),loadPopup()}function showEvent(e){window.location="../events/"+e}function getWorkHours(e){return time_day=[],$.ajax({url:"/user/"+e+"/work_day?gmt="+get_gmt_offset(),async:!1,success:function(e){time_day=e}}),time_day}function sendToServer(){return 0==options.length?void showError("Please select proposals before sending"):(popupLoading(),data={proposals:options,request_info:{mail:request_info_data.mail,name:request_info_data.name},event_metadata:{subject:request_info_data.subject,location:request_info_data.location},user_name:user_email,gmt_offset:get_gmt_offset()},void $.ajax({type:"POST",url:"/requests/proposels",dataType:"json",data:data,beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))}}).success(function(){$.each(options,function(e,t){$("#calendar").fullCalendar("removeEvents",t.temp_id)}),options=[],$("#proposal_table tbody").empty(),closeLoading(),showPopup("Woo Hoo!","The request has sent succesfully!","btn-success")}).fail(function(e){showError(getErrorFromData(e)),console.log(e),closeLoading()}))}function addNewProposal(e,t,n,o){proposel={start_ticks:e.unix(),end_ticks:t.unix(),temp_id:n,title:o},options.push(proposel)}function updateEvent(e){$.each(options,function(t,n){return n.temp_id==e.id?(n.start_ticks=e.start.unix(),void(n.end_ticks=e.end.unix())):void 0});var t=$("#prop_"+e.id+">td");t.length>0&&($(t[1]).html(date_to_human(e.start)),$(t[2]).html(date_to_human(e.end)))}function addProposalToPopup(e){$("#proposal_table tbody").append('<tr id="prop_'+e.temp_id+'"><td>'+getRemoveButtonTd(e.temp_id)+'</td><td class="start_time">'+date_to_human(e.start_time)+'</td><td class="end_time">'+date_to_human(e.end_time)+"</tr>")}function getRemoveButtonTd(e){return'<button type="button" class="btn btn-danger remove-prop-btn" onclick="removeProposel(\''+e+'\')"> <span class="glyphicon glyphicon-remove"/></button>'}function removeProposel(e){$("#prop_"+e).fadeOut(300,function(){$(this).remove()});var t=options.filter(function(t){return t.temp_id==e});index=$(options).index(t[0]),options.splice(index,1),$("#calendar").fullCalendar("removeEvents",e)}function changeRequestInputDisable(e){$("#event_subject_input").prop("disabled",e),$("#event_location_input").prop("disabled",e),$("#request_mail_input").prop("disabled",e),$("#request_name_input").prop("disabled",e),$("#send_request_btn").prop("disabled",e),$("#services").prop("disabled",e),$(".remove-prop-btn").prop("disabled",e)}function clearRequestedForm(){$("#event_subject_input").val(""),$("#event_location_input").val(""),$("#request_mail_input").val(""),$("#request_name_input").val("")}function saveLocalEvents(){$.ajax({type:"PUT",url:"/local",data:{events:options},beforeSend:function(e){popupLoading(),e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))}}).success(function(){disablePopup()}).fail(function(){disablePopup()})}function showRequestInfoWindow(){$("#requestInfoModal").modal("show")}function saveRequestInfoData(){request_info_data={mail:$("#request_mail_input").val(),name:$("#request_name_input").val(),subject:$("#event_subject_input").val(),location:$("#event_location_input").val()},$("#requestInfoModal").modal("hide")}function getCalendarHeight(){return.85*$(window).height()}var options=[],user_email,request_info_data={};$(document).ready(function(){$(window).resize(function(){$("#calendar").fullCalendar("option","height",getCalendarHeight())}),$(".group_user_input").change(function(){$("."+this.value).toggle()})});