<% content_for :javascripts do %>
    <%= javascript_include_tag "web_mails" %>
<% end %>

<% content_for :setting_data do %>
	<h1>Gmail</h1>
	<% if(@current_full_user.mail_importer.all?{|importer| !(importer.specific.is_a? GmailImporter)}) %>
		<%= link_to "Add Gmail Account", "/auth/google_oauth2", :target => "_blank" %>
	<% else %>
		<%= link_to "Signout from Gmail", "/settings/logout" %>
	<% end %>

	<h1>Local</h1>
	<% if(@current_full_user.mail_importer.all?{|importer| !(importer.specific.is_a? LocalImporter)}) %>
		<%= link_to "Create local account", {:controller => :local_events, :action => :create}, {:method => :post} %>
	<% else %>
		<%#= link_to "Signout from Gmail", "/settings/logout" %>
		You already have a local account
	<% end %>

	<h1>Exchange</h1>
	<% if(@current_full_user.mail_importer.all?{|importer| !(importer.specific.is_a? ExchangeImporter)}) %>
		<%= render partial:'exchange', locals: { importer: ExchangeImporter.new } %> 
	<% else %>
		<% importer = @current_full_user.mail_importer.select{|importer| (importer.specific.is_a? ExchangeImporter)}.first.specific %>
		<%= render partial:'exchange', locals: { importer: importer } %> 
		<%= link_to 'Destroy', importer, method: :delete, data: { confirm: 'Are you sure?' }, id: importer.id, :class => 'btn btn-danger' %>
		<%= link_to "Reset Errors (#{importer.error_count})" , importer, method: :put, data: { confirm: 'Are you sure?' }, id: importer.id, :class => 'btn btn-warning' %>
	<% end %>
<% end %>

<%= render template: "settings/settings" %>